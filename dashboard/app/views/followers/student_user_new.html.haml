- if !@section
  = t('add_teacher_form.code.instructions')
  %br/
  = form_tag(student_user_new_path, method: 'GET') do
    = text_field_tag(:section_code, params[:section_code], placeholder: I18n.t('add_teacher_form.code.placeholder'))
    %br/
    = submit_tag 'Go', class: 'btn btn-primary'
- elsif current_user
  You are currently signed in. #{link_to 'Return home', root_path} or #{link_to('log out', destroy_user_session_path)} to proceed.
- else
  %h2 Register to join the class #{@section.name} taught by #{@section.user.name}
  %p
    If you already have an account at Code.org, please
    %a{href: "/users/sign_in?return_to=/join/#{params[:section_code]}"} sign into your account
    before joining the section.
  %p{style: 'margin-bottom: 30px;'} If you don't have an account at Code.org yet, please fill out the fields below to create an account and join the section.
  - if @user.errors.any?
    #error_explanation
      %ul
        - @user.errors.full_messages.each do |msg|
          %li= msg

  -# Hack to look for a specific pattern in the class name to decide if it's a workshop.
  -# user_type = @section.name.to_s =~ /^Workshop on [\d\/]+ at .+$/ ? User::TYPE_TEACHER : User::TYPE_STUDENT

  #signup
    .rows
      .span8.signupblock
        - resource = @user
        - resource_name = "user"

        = form_for(resource, as: resource_name, url: registration_path(resource_name), html: {class: 'signupform'}) do |f|

          = f.hidden_field :section_code, value: params[:section_code]
          = render partial: "devise/shared/signup_form", locals: { url: { action: :student_register }, f: f, resource_name: resource_name, return_to_url: nil, is_teacher: false}
